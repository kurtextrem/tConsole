/*! tConsole v1.0 kurtextrem.de | LGPL */
!function($){var tConsole={$this:0,main:function(options,templates){var _this=this,$this=this.$this,settings={vendor:"kurtextrem",commandUrl:"cmds.php?cmd=",year:(new Date).getFullYear(),appname:"tConsole",version:"1.0",json:!0},tpl={engine:'<span class="tConsole-appname"></span> [Version <span class="tConsole-version"></span>]',copyright:'Copyright (c) <span class="tConsole-year"></span> <span class="tConsole-vendor"></span>. All rights served.',error:'<div class="tConsole-answer">Oups, the request\'s gone wrong! Please try again.</div>',header:'<header><div class="tConsole-app"></div><div class="tConsole-copyright"></div></header>',body:'<div class="tConsole-input"><span class="tConsole-path"></span><span class="tConsole-command"></span><span class="tConsole-cursor">_</span></div>'};return options&&$.extend(settings,options),templates&&$.extend(tpl,templates),$this.html('<div class="tConsole" tabindex="1">'+tpl.header+tpl.body+"</div>"),$this=this.$this=$this.find(".tConsole"),$this.find(".tConsole-app").html(tpl.engine),$this.find(".tConsole-copyright").html(tpl.copyright),$this.find(".tConsole-appname").text(settings.appname),$this.find(".tConsole-path").last().text(location.hostname+">"),$this.find(".tConsole-year").text(settings.year),$this.find(".tConsole-vendor").text(settings.vendor),$this.find(".tConsole-version").text(settings.version),window.setInterval(function(){$this.data("cursor-idle")?$this.find(".tConsole-cursor").hide():$this.find(".tConsole-cursor").toggle()},500),$this.keypress(function(a){if(!$this.data("cursor-idle")&&a.which>46&&a.which<253){var b=String.fromCharCode(a.which);a.shiftKey||(b=b.toLowerCase()),$(".tConsole-command").last().append(b),a.preventDefault()}}).keydown(function(e){var cmd=$(".tConsole-command").last().text(),action=!1;e.which==13&&(cmd=cmd.replace(/\s/,"%20"),_this.disableCursor(),settings.json&&$.trim(cmd)!==""?$.ajax(settings.commandUrl+cmd,{success:function(ret){var answer=ret;settings.json&&(ret=$.parseJSON(ret),answer=ret.answer,ret.handle&&eval(ret.handle)),_this.newConsoleLine(answer,tpl.body)},error:function(){_this.newConsoleLine(tpl.error,tpl.body)}}):$.trim(cmd)===""&&_this.newConsoleLine(0,tpl.body),action=!0),e.which===8&&($this.find(".tConsole-command").last().text(cmd.substr(0,cmd.length-1)),action=!0),e.which===32&&($this.find(".tConsole-command").last().text(cmd+" "),action=!0),_this.enableCursor(),action&&e.preventDefault()}).blur(function(){_this.disableCursor()}).focus(function(){_this.enableCursor()}),$this.focus(),$this},enableCursor:function(){this.$this.data("cursor-idle",!1)},disableCursor:function(){this.$this.data("cursor-idle",!0)},newConsoleLine:function(a,b){a&&this.$this.find(".tConsole-command").last().after('<div class="tConsole-answer">'+a+"</div>"),this.$this.find(".tConsole-cursor").remove(),this.$this.append(b),this.$this.find(".tConsole-path").last().text(location.hostname+">")}};$.fn.tConsole=function(a,b){this.tConsole=tConsole,this.tConsole.$this=this,this.tConsole.main(a,b)}}(jQuery)